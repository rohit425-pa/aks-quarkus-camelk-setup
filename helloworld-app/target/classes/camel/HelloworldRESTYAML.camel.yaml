- route:
    id: openapi-loader
    from:
      uri: rest-openapi:classpath:helloworld.yaml
      steps:
        - log:
            id: log-3714
            message: "OpenAPI route loaded: ${body}"
- route:
    id: get-helloworld
    from:
      uri: direct:getHello
      steps:
        - log:
            message: "HelloWorld GET request received"
        - setHeader:
            constant: application/json
            name: Content-Type
        # SECURE DEMO IMPLEMENTATION - No hardcoded credentials
        - choice:
            when:
              - simple: "${headers.demo} == 'external'"
                steps:
                  # For demo purposes, simulate external API call with mock data
                  - setBody:
                      constant: |
                        {
                          "message": "Hello from secure HelloWorld API!",
                          "timestamp": "${date:now:yyyy-MM-dd'T'HH:mm:ss'Z'}",
                          "version": "2.0-SNAPSHOT",
                          "environment": "demo",
                          "features": [
                            "REST OpenAPI integration",
                            "Secure configuration",
                            "JSON processing",
                            "Container-ready"
                          ]
                        }
                  - log:
                      message: "Mock external API response: ${body}"
            otherwise:
              steps:
                # Default simple response
                - setBody:
                    simple: |
                      {
                        "message": "Hello World from Camel K on AKS!",
                        "timestamp": "${date:now:yyyy-MM-dd'T'HH:mm:ss'Z'}",
                        "version": "2.0-SNAPSHOT",
                        "requestId": "${id}"
                      }
        # Process JSON response
        - unmarshal:
            json:
              library: Jackson
        - marshal:
            json:
              library: Jackson
              prettyPrint: true
        - log:
            message: "Final Response to client: ${body}"
- route:
    id: post-helloworld
    from:
      uri: direct:postHello
      steps:
        - log:
            id: log-1446
            message: "POST request received: ${body}"
        - setHeader:
            constant: application/json
            name: Content-Type
        - transform:
            simple: |
              {
                "message": "Hello from POST route!",
                "receivedData": "${body}",
                "timestamp": "${date:now:yyyy-MM-dd'T'HH:mm:ss'Z'}",
                "version": "2.0-SNAPSHOT"
              }